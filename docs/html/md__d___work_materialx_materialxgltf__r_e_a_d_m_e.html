<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MaterialXglTF: materialxgltf</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MaterialXglTF
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md__d___work_materialx_materialxgltf__r_e_a_d_m_e.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">materialxgltf </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md4"></a>
Contents</h1>
<ul>
<li><a href="#Introduction">Introduction</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#usage">Usage</a></li>
<li><a href="#documentation">Documentation</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md5"></a>
Introduction</h1>
<p>This package supports the bi-directional translation between MaterialX materials and glTF materials. The minimum version of MaterialX required is 1.38 8 and the target glTF version is 2.0.1. <br  />
</p>
<p>Below is an example of converting the "Damaged Helmet" asset (found in the <a href="https://github.com/KhronosGroup/glTF-Sample-Models/tree/master/2.0/DamagedHelmet">glTF Sample Model repository</a> to MaterialX and previewing. <img src="https://github.com/kwokcb/glTF_MaterialX/raw/main/docs/gltf_import-graphEditor2.png" alt="" width="80%" class="inline"/></p>
<p>The functionality found here is equivalent to the C++ module available in <a href="https://github.com/kwokcb/glTF_MaterialX">this repository</a>. Note that additional documentation can be found on that site.</p>
<h1><a class="anchor" id="autotoc_md6"></a>
Installation</h1>
<p>The minimum version of Python is assumed to be 3.9.</p>
<p>The package can be installed using <code>pip</code>`:</p>
<div class="fragment"><div class="line">pip install materialxgltf</div>
</div><!-- fragment --><p>or the <a href="https://github.com/kwokcb/materialxgltf">source repository</a> can be cloned and the package built from the command line:</p>
<div class="fragment"><div class="line">py -m build</div>
</div><!-- fragment --><p>This will build a distribution folder called <code>dist</code> which contains a zip file which can be installed using:</p>
<div class="fragment"><div class="line">pip --install &lt;name of zip&gt;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md7"></a>
Requirements</h2>
<p>Requires the installation of the following packages:</p>
<ul>
<li><code>materialx</code> version 1.38.8 or higher: For editing MaterialX documents.</li>
<li><code>pygltflib</code> : For conversion from <code>glTF</code> to <code>glb</code> including packaging dependent geometry and image resources.</li>
</ul>
<h1><a class="anchor" id="autotoc_md8"></a>
Documentation</h1>
<p>For more detailed information about the workflow this package supports, please refer to this <a href="https://kwokcb.github.io/MaterialX_Learn/documents/workflow_gltf.html">documentation</a>.</p>
<p>Refer to <a href="https://kwokcb.github.io/materialxgltf/docs/html">this documentation</a> for API usage.</p>
<h1><a class="anchor" id="autotoc_md9"></a>
Usage</h1>
<p>&lt;script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.js"&gt; <br  />
 &lt;/script&gt;</p>
<p>&lt;model-viewer style='background-color:rgba(0, 0, 0, 1.0); width: 48em; height: 48em' id='viewer1' ar interaction-prompt='none' camera-controls touch-action='pan-y' src='./docs/data/BoomBoxWithAxes_primMaterials.glb' shadow-intensity='0.3' alt='BoomBox With Axes Per Prim Material' poster='./docs/data/BoomBoxWithAxes_primMaterials.png'&gt;&lt;/model-viewer&gt;</p>
<p>The following shows is a set of progressive examples to convert from a glTF file to MaterialX and then to a new glTF file for "shader ball" preview of extracted materials.</p>
<p>Note that the sample data is included as part of the package for convenience.</p>
<p>The sample input file is the "BoomBox with Axes" file from the glTF sample repository found <a href="https://github.com/KhronosGroup/glTF-Sample-Models/tree/master/2.0/BoomBoxWithAxes/glTF">here</a>.</p>
<p><img src="https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/BoomBoxWithAxes/screenshot/screenshot.jpg" alt="" class="inline"/></p>
<p>This is converted from glTF to a MaterialX document which can be previewed / modified using an integration which supports MaterialX. Here the file is loaded into the "MaterialX Graph Editor" which comes with <a href="https://github.com/AcademySoftwareFoundation/MaterialX/releases">MaterialX releases</a>.</p>
<p><img src="https://raw.githubusercontent.com/kwokcb/MaterialX_Learn/main/documents/images/gltf_to_mtlx_boombox_with_axes.png" alt="MaterialX Graph Editor Snapshot" width="80%" class="inline"/></p>
<p>The converted materials are then used to create a new glTF file using sample "shaderball" data with each material found assigned to different instances of the "shaderball"</p>
<p><img src="https://raw.githubusercontent.com/kwokcb/MaterialX_Learn/main/documents/images/mtlx_to_gltf_materialviewer.png" alt="VSCode Snapshot" width="50%" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md10"></a>
Interactive Example</h1>
<p>A <code>Jupyter</code> notebook which performs the same steps is available <a href="https://kwokcb.github.io/docs/examples.html">here</a>. This or any other notebook can be used if the user wishes to test the package in an interactive environment.</p>
<h2><a class="anchor" id="autotoc_md11"></a>
Import the package</h2>
<div class="fragment"><div class="line">import materialxgltf.core as core</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md12"></a>
Check Available Sample Data</h2>
<div class="fragment"><div class="line">import pkg_resources</div>
<div class="line"> </div>
<div class="line">directory_name = &quot;data&quot;  </div>
<div class="line">files = pkg_resources.resource_listdir(&#39;materialxgltf&#39;, directory_name)</div>
<div class="line">for file in files:</div>
<div class="line">    print(&#39;Data file: &#39;, file)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md13"></a>
Convert from glTF to MaterialX</h2>
<div class="fragment"><div class="line">import pkg_resources</div>
<div class="line">import MaterialX as mx</div>
<div class="line"> </div>
<div class="line">gltfFileName = pkg_resources.resource_filename(&#39;materialxgltf&#39;, &#39;data/BoomBoxWithAxes.gltf&#39;)</div>
<div class="line">print(gltfFileName)</div>
<div class="line"> </div>
<div class="line"># Instantiate a the reader class. Read in sample  glTF file</div>
<div class="line"># and output a MaterialX document</div>
<div class="line">gltf2MtlxReader = core.GLTF2MtlxReader()</div>
<div class="line">doc = gltf2MtlxReader.convert(gltfFileName)</div>
<div class="line">if not doc:</div>
<div class="line">    print(&#39;Existing due to error&#39;)</div>
<div class="line">else:</div>
<div class="line">    status, err = doc.validate()</div>
<div class="line">    if not status:</div>
<div class="line">        print(&#39;Generated MaterialX document has validation errors: &#39;, err)</div>
<div class="line">    else:</div>
<div class="line">        print(&#39;Generated MaterialX document is valid&#39;)</div>
<div class="line"> </div>
<div class="line"># Write the document to a string</div>
<div class="line">print(&#39;Resulting MaterialX document:\n&#39;)</div>
<div class="line">result = core.Util.writeMaterialXDocString(doc)</div>
<div class="line">print(result)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md14"></a>
Using glTF to MaterialX Options</h2>
<div class="fragment"><div class="line"># Set option to write material assignments</div>
<div class="line">options = core.GLTF2MtlxOptions()</div>
<div class="line">options[&#39;createAssignments&#39;] = True</div>
<div class="line">gltf2MtlxReader.setOptions(options)</div>
<div class="line"> </div>
<div class="line">doc = gltf2MtlxReader.convert(gltfFileName)</div>
<div class="line">if not doc:</div>
<div class="line">    print(&#39;Existing due to error&#39;)</div>
<div class="line">else:</div>
<div class="line">    status, err = doc.validate()</div>
<div class="line">    if not status:</div>
<div class="line">        print(&#39;Generated MaterialX document has validation errors: &#39;, err)</div>
<div class="line">    else:</div>
<div class="line">        print(&#39;Generated MaterialX document is valid&#39;)</div>
<div class="line"> </div>
<div class="line"># Write the document to a string</div>
<div class="line">print(&#39;Resulting MaterialX document:\n&#39;)</div>
<div class="line">result = core.Util.writeMaterialXDocString(doc)</div>
<div class="line">print(result)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md15"></a>
Conversion from MaterialX to glTF</h2>
<div class="fragment"><div class="line">materialXFileName = pkg_resources.resource_filename(&#39;materialxgltf&#39;, &#39;data/BoomBoxWithAxes.mtlx&#39;)</div>
<div class="line">print(&#39;&gt; Load MaterialX document: %s&#39; % materialXFileName)</div>
<div class="line"> </div>
<div class="line">mtlx2glTFWriter = core.MTLX2GLTFWriter()</div>
<div class="line">doc, libFiles = core.Util.createMaterialXDoc()</div>
<div class="line">mx.readFromXmlFile(doc, materialXFileName, mx.FileSearchPath())</div>
<div class="line"> </div>
<div class="line">options = core.MTLX2GLTFOptions()</div>
<div class="line">options[&#39;debugOutput&#39;] = True</div>
<div class="line">mtlx2glTFWriter.setOptions(options)</div>
<div class="line">gltfString = mtlx2glTFWriter.convert(doc)</div>
<div class="line">if len(gltfString) &gt; 0:</div>
<div class="line">    print(&#39;&gt; Resulting glTF:\n&#39;)</div>
<div class="line">    print(gltfString)</div>
<div class="line">else:</div>
<div class="line">    print(&#39;&gt; Failed to convert MaterialX document to glTF&#39;)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md16"></a>
Embedding Geometry</h2>
<div class="fragment"><div class="line">gltfGeometryFile = pkg_resources.resource_filename(&#39;materialxgltf&#39;, &#39;data/shaderBall.gltf&#39;)</div>
<div class="line">print(&#39;&gt; Load glTF geometry file: %s&#39; % gltfGeometryFile)</div>
<div class="line"> </div>
<div class="line">options = core.MTLX2GLTFOptions()</div>
<div class="line">options[&#39;geometryFile&#39;] = gltfGeometryFile</div>
<div class="line">options[&#39;primsPerMaterial&#39;] = False</div>
<div class="line">mtlx2glTFWriter.setOptions(options)</div>
<div class="line">gltfString = mtlx2glTFWriter.convert(doc)</div>
<div class="line">if len(gltfString) &gt; 0:</div>
<div class="line">    print(&#39;&gt; Resulting glTF:\n&#39;)</div>
<div class="line">    print(gltfString)</div>
<div class="line">else:</div>
<div class="line">    print(&#39;&gt; Failed to convert MaterialX document to glTF&#39;)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md17"></a>
Creating Primitives Per Material</h2>
<div class="fragment"><div class="line">gltfGeometryFile = pkg_resources.resource_filename(&#39;materialxgltf&#39;, &#39;data/shaderBall.gltf&#39;)</div>
<div class="line">print(&#39;&gt; Load glTF geometry file: %s&#39; % gltfGeometryFile)</div>
<div class="line"> </div>
<div class="line">options = core.MTLX2GLTFOptions()</div>
<div class="line">options[&#39;geometryFile&#39;] = gltfGeometryFile</div>
<div class="line">options[&#39;primsPerMaterial&#39;] = True</div>
<div class="line">mtlx2glTFWriter.setOptions(options)</div>
<div class="line">gltfString = mtlx2glTFWriter.convert(doc)</div>
<div class="line">if len(gltfString) &gt; 0:</div>
<div class="line">    print(&#39;&gt; Resulting glTF:\n&#39;)</div>
<div class="line">    print(gltfString)</div>
<div class="line">else:</div>
<div class="line">    print(&#39;&gt; Failed to convert MaterialX document to glTF&#39;)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md18"></a>
Packaging A Binary File</h2>
<div class="fragment"><div class="line">gltfFileName = pkg_resources.resource_filename(&#39;materialxgltf&#39;, &#39;data/BoomBoxWithAxes_primMaterials.gltf&#39;)</div>
<div class="line">print(&#39;&gt; Load glTF geometry file: %s&#39; % gltfGeometryFile)</div>
<div class="line">binaryFileName = str()</div>
<div class="line">binaryFileName = gltfFileName .replace(&#39;.gltf&#39;, &#39;.glb&#39;)</div>
<div class="line">print(&#39;Packaging GLB...&#39;)</div>
<div class="line">try:</div>
<div class="line">    saved, images, buffers = mtlx2glTFWriter.packageGLTF(gltfFileName , binaryFileName)</div>
<div class="line">    print(&#39;Save GLB file:&#39; + binaryFileName + &#39;. Status:&#39; + str(saved))</div>
<div class="line">    for image in images:</div>
<div class="line">        print(&#39;- Embedded image: %s&#39; % image)</div>
<div class="line">    for buffer in buffers:</div>
<div class="line">        print(&#39;  - Embedded buffer: %s&#39; % buffer)</div>
<div class="line">    print(&#39;Packaging GLB...Done&#39;)</div>
<div class="line">except Exception as err:</div>
<div class="line">    print(&#39;Failed to package GLB file: %s&#39; % err)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md19"></a>
Translate Shader and Bake Textures</h2>
<p>All materials are assumed to use glTF PBR surface shaders. Conversion to this shading model can be performed via MaterialX utilities, which includes texture baking.</p>
<p>Please refer to the sample Jupyter notebook for an example of shader translation and baking using some convenience functions included with the package. Note that they do not need to be used as the core MaterialX distribution provides access to the APIs used in this package.</p>
<h1><a class="anchor" id="autotoc_md20"></a>
Author</h1>
<ul>
<li>LinkedIn: <a href="https://www.linkedin.com/in/bernard-kwok/" target="_blank">Bernard Kwok</a></li>
<li>GitHub: <a href="https://github.com/kwokcb">kwokcb</a></li>
<li>Email: <a href="#" onclick="location.href='mai'+'lto:'+'kwo'+'kc'+'b@g'+'ma'+'il.'+'co'+'m'; return false;">kwokcb@gmail.com</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
